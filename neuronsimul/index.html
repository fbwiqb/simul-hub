<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹ ê²½ì„¸í¬ ë§‰ì „ìœ„ ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", sans-serif;
            background: linear-gradient(135deg, #f8f9ff 0%, #eef0f8 100%);
            min-height: 100vh;
            padding: 10px;
            padding-bottom: 10px;
            transition: background 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 10px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 22px;
                margin-bottom: 20px;
            }

            .control-row {
                flex-direction: column;
                gap: 15px;
            }

            input[type="range"] {
                width: 100%;
            }
        }

        h1 {
            text-align: center;
            font-size: 22px;
            margin-bottom: 10px;
            color: #2c3e50;
            text-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .control-panel {
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            transition: box-shadow 0.3s ease;
        }

        .control-panel:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        label {
            font-weight: 600;
            font-size: 16px;
        }

        input[type="number"] {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 15px;
            width: 80px;
            transition: all 0.2s ease;
        }

        input[type="number"]:focus {
            border-color: #3d4e9f;
            outline: none;
            box-shadow: 0 0 0 3px rgba(61,78,159,0.1);
        }

        select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 15px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        select:hover {
            border-color: #3d4e9f;
        }

        select:focus {
            border-color: #3d4e9f;
            outline: none;
            box-shadow: 0 0 0 3px rgba(61,78,159,0.1);
        }

        input[type="range"] {
            width: 800px;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #dee2e6;
            border-radius: 5px;
            outline: none;
        }

        @media (max-width: 1200px) {
            input[type="range"] {
                width: 600px;
            }
        }

        @media (max-width: 900px) {
            input[type="range"] {
                width: 400px;
            }
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3d4e9f;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(61,78,159,0.3);
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #2c3a7a;
            box-shadow: 0 3px 10px rgba(61,78,159,0.5);
            transform: scale(1.15);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3d4e9f;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(61,78,159,0.3);
            transition: all 0.2s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            background: #2c3a7a;
            box-shadow: 0 3px 10px rgba(61,78,159,0.5);
            transform: scale(1.15);
        }

        .time-display {
            font-size: 18px;
            font-weight: bold;
            color: #3d4e9f;
            min-width: 80px;
            text-align: center;
        }

        button {
            padding: 10px 25px;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .btn-help {
            background: linear-gradient(135deg, #3d4e9f 0%, #5068c4 100%);
            color: white;
        }

        .btn-help:hover {
            background: linear-gradient(135deg, #2c3a7a 0%, #3d4e9f 100%);
        }

        .btn-reset {
            background: linear-gradient(135deg, #dc3545 0%, #e85d6a 100%);
            color: white;
        }

        .btn-reset:hover {
            background: linear-gradient(135deg, #c82333 0%, #dc3545 100%);
        }

        .btn-play {
            background: linear-gradient(135deg, #28a745 0%, #48c774 100%);
            color: white;
            min-width: 120px;
        }

        .btn-play:hover {
            background: linear-gradient(135deg, #218838 0%, #28a745 100%);
        }

        .btn-play.playing {
            background: linear-gradient(135deg, #fd7e14 0%, #fdab6c 100%);
        }

        .btn-play.playing:hover {
            background: linear-gradient(135deg, #e8590c 0%, #fd7e14 100%);
        }

        .btn-capture {
            background: linear-gradient(135deg, #28a745 0%, #48c774 100%);
            color: white;
            padding: 8px 20px;
            font-size: 14px;
            margin-left: 10px;
        }

        .btn-capture:hover {
            background: linear-gradient(135deg, #218838 0%, #28a745 100%);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #3d4e9f 0%, #667eea 100%);
            color: white;
            padding: 20px;
            margin: -30px -30px 20px -30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: white;
            margin: 0;
            font-size: 24px;
        }

        .modal-close {
            background: none;
            color: white;
            border: none;
            font-size: 30px;
            cursor: pointer;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg) scale(1.1);
        }

        .modal-close:active {
            transform: rotate(90deg) scale(0.95);
        }

        .modal-body {
            padding: 10px;
            color: #333;
            line-height: 1.8;
        }

        .help-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3d4e9f;
            transition: all 0.2s ease;
        }

        .help-section:hover {
            background: #f1f3f5;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .help-section h3 {
            color: #3d4e9f;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .help-section p, .help-section ul {
            margin: 10px 0;
        }

        .help-section ul {
            padding-left: 25px;
        }

        .help-section li {
            margin: 8px 0;
        }

        .help-section strong {
            color: #3d4e9f;
        }

        .voltage-table-container {
            border: 2px solid #dee2e6;
            background-color: white;
            padding: 8px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 8px;
            transition: box-shadow 0.3s ease;
        }

        .voltage-table-container:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .voltage-table-container h4 {
            margin-top: 0;
            text-align: center;
            font-size: 13px;
            margin-bottom: 6px;
            color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .voltage-table {
            width: 100%;
            border-collapse: collapse;
        }

        .voltage-table th,
        .voltage-table td {
            border: 2px solid #dee2e6;
            padding: 5px 8px;
            text-align: center;
        }

        .voltage-table th {
            background-color: #e9ecef;
            font-weight: 600;
            font-size: 12px;
        }

        .voltage-table th span {
            font-size: 9px;
            font-weight: 400;
            color: #6c757d;
        }

        .voltage-table td {
            font-size: 13px;
            font-weight: 500;
        }

        .voltage-table td.time-cell {
            font-weight: bold;
            background-color: #f8f9fa;
            font-size: 12px;
        }

        .voltage-table td.voltage-cell {
            background-color: white;
            color: #212529;
        }

        .captured-row {
            background-color: #f8f9fa !important;
        }

        .captured-row td {
            background-color: #f8f9fa !important;
        }

        .live-row td.voltage-cell {
            font-weight: bold;
        }

        .delete-btn {
            background: linear-gradient(135deg, #dc3545 0%, #e85d6a 100%);
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(220,53,69,0.3);
        }

        .delete-btn:hover {
            background: linear-gradient(135deg, #c82333 0%, #dc3545 100%);
            transform: scale(1.05);
            box-shadow: 0 2px 6px rgba(220,53,69,0.4);
        }

        .delete-btn:active {
            transform: scale(0.95);
        }

        .neuron-container {
            background: linear-gradient(135deg, #e7f3ff 0%, #d4ebff 100%);
            border: 2px solid #0066cc;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 8px;
            box-shadow: 0 2px 8px rgba(0,102,204,0.1);
            transition: box-shadow 0.3s ease;
        }

        .neuron-container:hover {
            box-shadow: 0 4px 12px rgba(0,102,204,0.15);
        }

        #neuronSvg {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
        }

        .graphs-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 15px;
            padding: 0 10px;
            width: 100%;
        }

        .graphs-container .graph-box {
            flex: 1 1 calc(50% - 6px);
            min-width: 280px;
        }

        @media (max-width: 767px) {
            .graphs-container .graph-box {
                flex: 1 1 100%;
            }
        }

        .graph-box {
            background: white;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            min-width: 0;
        }

        .graph-box:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .graph-box.graph-hidden {
            display: none;
        }

        .graph-box canvas {
            width: 100% !important;
            height: auto !important;
        }

        .graph-box h3 {
            text-align: center;
            margin-bottom: 4px;
            font-size: 12px;
            padding-bottom: 4px;
        }

        .graph-info {
            text-align: center;
            background: #f8f9fa;
            padding: 4px;
            border-radius: 4px;
            margin-bottom: 6px;
            font-size: 10px;
        }

        .graph-info strong {
            font-size: 11px;
        }

        .footer {
            background: #3d4e9f;
            color: white;
            text-align: center;
            padding: 10px 20px;
            font-size: 14px;
            margin-top: 20px;
        }

        .footer a {
            color: white;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .checkbox-group label {
            cursor: pointer;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  ì‹ ê²½ì„¸í¬ ë§‰ì „ìœ„ ì‹œë®¬ë ˆì´í„°</h1>

        <div class="control-panel">
            <div class="control-row">
                <div class="control-group">
                    <label>ğŸ¯ ìê·¹ ì§€ì :</label>
                    <select id="stimulationPoint">
                        <option value="0">dâ‚ (0cm)</option>
                        <option value="1">dâ‚‚ (2cm)</option>
                        <option value="2">dâ‚ƒ (4cm)</option>
                        <option value="3">dâ‚„ (6cm)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>âš¡ ì „ë„ ì†ë„ (cm/ms):</label>
                    <input type="number" id="speedInput" value="2" step="0.1" min="0.1">
                </div>

                <div class="control-group">
                    <button class="btn-help" id="helpBtn">ğŸ“– ì‚¬ìš©ë²•</button>
                    <button class="btn-help" id="devLogBtn">ğŸ“ ê°œë°œì ë¡œê·¸</button>
                    <button class="btn-reset" id="resetBtn">ğŸ”„ ì´ˆê¸°í™”</button>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group" style="flex: 1;">
                    <label>â±ï¸ ì‹œê°„ ì¡°ì ˆ:</label>
                    <button class="btn-play" id="playBtn">â–¶ ì¬ìƒ</button>
                    <input type="range" id="timeSlider" min="0" max="8" step="0.1" value="0">
                    <span class="time-display" id="timeDisplay">0.0 ms</span>
                </div>
            </div>

            <div class="control-row">
                <div class="checkbox-group">
                    <span style="font-weight: 600;">ğŸ“Š ê·¸ë˜í”„ í‘œì‹œ:</span>
                    <label><input type="checkbox" class="graph-toggle" data-index="0" checked> 0cm</label>
                    <label><input type="checkbox" class="graph-toggle" data-index="1" checked> 2cm</label>
                    <label><input type="checkbox" class="graph-toggle" data-index="2" checked> 4cm</label>
                    <label><input type="checkbox" class="graph-toggle" data-index="3" checked> 6cm</label>
                </div>
            </div>
        </div>

        <div class="neuron-container">
            <svg id="neuronSvg" viewBox="0 0 950 150" preserveAspectRatio="xMidYMid meet">
                <g id="dendrites">
                    <path d="M 100 45 L 100 25 M 100 25 L 95 15 M 100 25 L 105 15" stroke="#CD853F" stroke-width="1.5" fill="none" />
                    <path d="M 85 50 L 75 30 M 75 30 L 70 20 M 75 30 L 65 25" stroke="#CD853F" stroke-width="1.5" fill="none" />
                    <path d="M 115 50 L 125 30 M 125 30 L 130 20 M 125 30 L 135 25" stroke="#CD853F" stroke-width="1.5" fill="none" />
                    <path d="M 70 75 L 50 75 M 50 75 L 40 70 M 50 75 L 40 80" stroke="#CD853F" stroke-width="1.5" fill="none" />
                    <path d="M 75 60 L 55 45 M 55 45 L 45 40 M 55 45 L 50 35" stroke="#CD853F" stroke-width="1.5" fill="none" />
                    <path d="M 75 90 L 55 105 M 55 105 L 45 110 M 55 105 L 50 115" stroke="#CD853F" stroke-width="1.5" fill="none" />
                    <path d="M 100 105 L 100 125 M 100 125 L 95 135 M 100 125 L 105 135" stroke="#CD853F" stroke-width="1.5" fill="none" />
                    <path d="M 85 100 L 75 120 M 75 120 L 70 130 M 75 120 L 65 125" stroke="#CD853F" stroke-width="1.5" fill="none" />
                    <path d="M 115 100 L 125 120 M 125 120 L 130 130 M 125 120 L 135 125" stroke="#CD853F" stroke-width="1.5" fill="none" />
                </g>

                <circle cx="100" cy="75" r="30" fill="#FFE4B5" stroke="#8B4513" stroke-width="2" />
                <circle cx="100" cy="75" r="10" fill="#CD853F" />

                <rect x="130" y="69" width="750" height="12" fill="#FFE4B5" stroke="#8B4513" stroke-width="1" />

                <g id="axon-terminal">
                    <path d="M 880 75 L 920 60" stroke="#8B4513" stroke-width="2" fill="none" />
                    <path d="M 880 75 L 920 75" stroke="#8B4513" stroke-width="2" fill="none" />
                    <path d="M 880 75 L 920 90" stroke="#8B4513" stroke-width="2" fill="none" />
                    <circle cx="920" cy="60" r="5" fill="#FFE4B5" stroke="#8B4513" stroke-width="1" />
                    <circle cx="920" cy="75" r="5" fill="#FFE4B5" stroke="#8B4513" stroke-width="1" />
                    <circle cx="920" cy="90" r="5" fill="#FFE4B5" stroke="#8B4513" stroke-width="1" />
                </g>

                <text x="100" y="140" text-anchor="middle" font-size="14" font-weight="bold">ì„¸í¬ì²´</text>

                <g id="d1-marker">
                    <line x1="250" y1="30" x2="250" y2="120" stroke="black" stroke-width="2" stroke-dasharray="5 3" />
                    <text x="250" y="140" text-anchor="middle" font-size="14" font-weight="bold">0cm</text>
                    <text x="250" y="20" text-anchor="middle" font-size="16" font-weight="bold">dâ‚</text>
                </g>
                <g id="d2-marker">
                    <line x1="430" y1="30" x2="430" y2="120" stroke="black" stroke-width="2" stroke-dasharray="5 3" />
                    <text x="430" y="140" text-anchor="middle" font-size="14" font-weight="bold">2cm</text>
                    <text x="430" y="20" text-anchor="middle" font-size="16" font-weight="bold">dâ‚‚</text>
                </g>
                <g id="d3-marker">
                    <line x1="610" y1="30" x2="610" y2="120" stroke="black" stroke-width="2" stroke-dasharray="5 3" />
                    <text x="610" y="140" text-anchor="middle" font-size="14" font-weight="bold">4cm</text>
                    <text x="610" y="20" text-anchor="middle" font-size="16" font-weight="bold">dâ‚ƒ</text>
                </g>
                <g id="d4-marker">
                    <line x1="790" y1="30" x2="790" y2="120" stroke="black" stroke-width="2" stroke-dasharray="5 3" />
                    <text x="790" y="140" text-anchor="middle" font-size="14" font-weight="bold">6cm</text>
                    <text x="790" y="20" text-anchor="middle" font-size="16" font-weight="bold">dâ‚„</text>
                </g>

                <g id="spark1" transform="translate(250, 75)" style="display: none;">
                    <circle r="20" fill="yellow" opacity="0.4" />
                    <text font-size="24" fill="gold" dominant-baseline="middle" text-anchor="middle">âš¡</text>
                </g>

                <g id="spark2" transform="translate(250, 75)" style="display: none;">
                    <circle r="20" fill="yellow" opacity="0.4" />
                    <text font-size="24" fill="gold" dominant-baseline="middle" text-anchor="middle">âš¡</text>
                </g>
            </svg>
        </div>

        <div class="voltage-table-container">
            <h4>
                ğŸ“ˆ ê° ì§€ì ì˜ ë§‰ì „ìœ„ (mV)
                <button class="btn-capture" onclick="captureData()">ğŸ“¸ ìº¡ì²˜</button>
            </h4>
            <table class="voltage-table">
                <thead>
                    <tr>
                        <th>ì‹œê°„</th>
                        <th>dâ‚ <span>(0cm)</span></th>
                        <th>dâ‚‚ <span>(2cm)</span></th>
                        <th>dâ‚ƒ <span>(4cm)</span></th>
                        <th>dâ‚„ <span>(6cm)</span></th>
                        <th>ì‚­ì œ</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr class="live-row">
                        <td class="time-cell" id="tableTime">0.0 ms</td>
                        <td class="voltage-cell" id="tableVoltage0">-70.0</td>
                        <td class="voltage-cell" id="tableVoltage1">-70.0</td>
                        <td class="voltage-cell" id="tableVoltage2">-70.0</td>
                        <td class="voltage-cell" id="tableVoltage3">-70.0</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="graphs-container">
            <div class="graph-box" id="graph0">
                <h3 style="border-bottom: 3px solid #0066cc;">ğŸ“ 0cm ì§€ì </h3>
                <div class="graph-info">
                    í˜„ì¬ ë§‰ì „ìœ„: <strong id="voltage0">-70 mV</strong><br>
                    ìê·¹ í›„ ê²½ê³¼ ì‹œê°„: <strong id="time0">ë„ë‹¬ ì „</strong>
                </div>
                <canvas id="chart0"></canvas>
            </div>

            <div class="graph-box" id="graph1">
                <h3 style="border-bottom: 3px solid #fd7e14;">ğŸ“ 2cm ì§€ì </h3>
                <div class="graph-info">
                    í˜„ì¬ ë§‰ì „ìœ„: <strong id="voltage1">-70 mV</strong><br>
                    ìê·¹ í›„ ê²½ê³¼ ì‹œê°„: <strong id="time1">ë„ë‹¬ ì „</strong>
                </div>
                <canvas id="chart1"></canvas>
            </div>

            <div class="graph-box" id="graph2">
                <h3 style="border-bottom: 3px solid #28a745;">ğŸ“ 4cm ì§€ì </h3>
                <div class="graph-info">
                    í˜„ì¬ ë§‰ì „ìœ„: <strong id="voltage2">-70 mV</strong><br>
                    ìê·¹ í›„ ê²½ê³¼ ì‹œê°„: <strong id="time2">ë„ë‹¬ ì „</strong>
                </div>
                <canvas id="chart2"></canvas>
            </div>

            <div class="graph-box" id="graph3">
                <h3 style="border-bottom: 3px solid #dc3545;">ğŸ“ 6cm ì§€ì </h3>
                <div class="graph-info">
                    í˜„ì¬ ë§‰ì „ìœ„: <strong id="voltage3">-70 mV</strong><br>
                    ìê·¹ í›„ ê²½ê³¼ ì‹œê°„: <strong id="time3">ë„ë‹¬ ì „</strong>
                </div>
                <canvas id="chart3"></canvas>
            </div>
        </div>
    </div>

    <div class="footer">
        â“’ 2025-2026 ì¶©ë‚¨ì‚¼ì„±ê³ ë“±í•™êµ ì‹ ë„ê²½T<br>
        <a href="mailto:pantarei01@cnsa.hs.kr">pantarei01@cnsa.hs.kr</a>
    </div>

    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“– ì‹ ê²½ì„¸í¬ ë§‰ì „ìœ„ ì‹œë®¬ë ˆì´í„° ì‚¬ìš©ë²•</h2>
                <button class="modal-close" onclick="closeHelp()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3>ğŸ¯ í”„ë¡œê·¸ë¨ ì†Œê°œ</h3>
                    <p><strong>ì‹ ê²½ì„¸í¬ ë§‰ì „ìœ„ ì‹œë®¬ë ˆì´í„°</strong>ëŠ” ì‹ ê²½ì„¸í¬ì—ì„œ í™œë™ì „ìœ„ê°€ ì¶•ì‚­ì„ ë”°ë¼ ì „ë„ë˜ëŠ” ê³¼ì •ì„ ì‹œê°ì ìœ¼ë¡œ ê´€ì°°í•  ìˆ˜ ìˆëŠ” êµìœ¡ìš© í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.</p>
                </div>

                <div class="help-section">
                    <h3>ğŸ® ê¸°ë³¸ ì‚¬ìš©ë²•</h3>
                    <p><strong>1. ìê·¹ ì§€ì  ì„ íƒ</strong></p>
                    <ul>
                        <li><strong>ğŸ¯ ìê·¹ ì§€ì </strong>: dâ‚(0cm)~dâ‚„(6cm) ì¤‘ ìê·¹ ìœ„ì¹˜ë¥¼ ì„ íƒí•©ë‹ˆë‹¤</li>
                        <li>dâ‚ì´ë‚˜ dâ‚„: í•œ ë°©í–¥ ì „íŒŒ / dâ‚‚ë‚˜ dâ‚ƒ: ì–‘ë°©í–¥ ì „íŒŒ</li>
                    </ul>
                    <p><strong>2. ì „ë„ ì†ë„ ì„¤ì •</strong></p>
                    <ul>
                        <li>ê¸°ë³¸ê°’ 2 cm/ms, 0.1 ë‹¨ìœ„ë¡œ ì¡°ì ˆ</li>
                        <li>ì†ë„ ë³€ê²½ ì‹œ ì‹œê°„ ìŠ¬ë¼ì´ë” ë²”ìœ„ê°€ ìë™ ì¡°ì •ë©ë‹ˆë‹¤</li>
                    </ul>
                    <p><strong>3. ì‹œê°„ ì¡°ì ˆ / ì¬ìƒ</strong></p>
                    <ul>
                        <li><strong>â–¶ ì¬ìƒ</strong>: ìë™ìœ¼ë¡œ ì‹œê°„ì´ íë¥´ë©° ì „íŒŒ ê´€ì°°</li>
                        <li>ìŠ¬ë¼ì´ë”ë¥¼ ì§ì ‘ ì›€ì§ì—¬ ì›í•˜ëŠ” ì‹œê°„ìœ¼ë¡œ ì´ë™</li>
                    </ul>
                    <p><strong>4. ë°ì´í„° ìº¡ì²˜</strong></p>
                    <ul>
                        <li>ğŸ“¸ ìº¡ì²˜: í˜„ì¬ ì‹œê°„ì˜ ë§‰ì „ìœ„ë¥¼ í‘œì— ê³ ì •</li>
                        <li>ì—¬ëŸ¬ ì‹œì ì„ ìº¡ì²˜í•˜ì—¬ ë¹„êµ ë¶„ì„ ê°€ëŠ¥</li>
                    </ul>
                    <p><strong>5. ë§‰ì „ìœ„ ìƒ‰ìƒ í‘œì‹œ</strong></p>
                    <ul>
                        <li>íšŒìƒ‰: íœ´ì§€ì „ìœ„ / ë¹¨ê°•: íƒˆë¶„ê·¹ / ì´ˆë¡: ì¬ë¶„ê·¹ / íŒŒë‘: ê³¼ë¶„ê·¹</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>ğŸ”¬ ê³¼í•™ì  ë°°ê²½</h3>
                    <p>ìê·¹ì´ ì—­ì¹˜ë¥¼ ë„˜ìœ¼ë©´ Naâº í†µë¡œê°€ ì—´ë¦¬ë©° ë§‰ì „ìœ„ê°€ ê¸‰ê²©íˆ ìƒìŠ¹(íƒˆë¶„ê·¹)í•˜ê³ , Kâº í†µë¡œê°€ ì—´ë¦¬ë©° ë‹¤ì‹œ í•˜ê°•(ì¬ë¶„ê·¹)í•©ë‹ˆë‹¤. ì´ í™œë™ì „ìœ„ëŠ” ì¶•ì‚­ì„ ë”°ë¼ ì „íŒŒë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="devLogModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“ ê°œë°œì ë¡œê·¸</h2>
                <button class="modal-close" onclick="closeDevLog()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <div class="log-date" style="color: #3d4e9f; font-weight: bold; font-size: 1.1em; margin-bottom: 10px;">2026. 2. 24. (ì›”)</div>
                    <div class="log-text">
                        <strong>ì‹ ê²½ì„¸í¬ ë§‰ì „ìœ„ ì‹œë®¬ë ˆì´í„° v3.0 ì—…ë°ì´íŠ¸</strong><br>
                        - ğŸ“ˆ ì§€ìˆ˜í•¨ìˆ˜ í˜•íƒœì˜ í™œë™ì „ìœ„ íŒŒí˜•ìœ¼ë¡œ ê°œì„  (Hodgkin-Huxley ê·¼ì‚¬)<br>
                        - â±ï¸ ë™ì  ì‹œê°„ ìŠ¬ë¼ì´ë” ë²”ìœ„ (ì „ë„ ì†ë„ì— ë”°ë¼ ìë™ ì¡°ì •)<br>
                        - â–¶ï¸ ì¬ìƒ/â¸ï¸ ì¼ì‹œì •ì§€ ì• ë‹ˆë©”ì´ì…˜ ê¸°ëŠ¥<br>
                        - ğŸ”„ ì´ˆê¸°í™” ë²„íŠ¼<br>
                        - ğŸ¨ ì „ì•• ê¸°ë°˜ ìƒ‰ìƒ ì‹œìŠ¤í…œ<br>
                        - âš¡ ì„±ëŠ¥ ìµœì í™” (ë°ì´í„° ìºì‹±, ìˆ¨ê¸´ ê·¸ë˜í”„ ìŠ¤í‚µ)<br>
                        - ğŸ“± ë°˜ì‘í˜• SVG (ëª¨ë°”ì¼ ê°œì„ )<br><br>
                        í™œë™ì „ìœ„ íŒŒí˜•ì„ ì§€ìˆ˜í•¨ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ì¬ì„¤ê³„í•˜ì—¬ ë” ì‚¬ì‹¤ì ì¸ ì‹œë®¬ë ˆì´ì…˜ì´ ê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤.
                    </div>
                </div>

                <div class="help-section">
                    <div class="log-date" style="color: #3d4e9f; font-weight: bold; font-size: 1.1em; margin-bottom: 10px;">2025. 10. 27. (ì›”)</div>
                    <div class="log-text">
                        <strong>v2.0 ì—…ë°ì´íŠ¸</strong><br>
                        - ğŸ¯ ìê·¹ ì§€ì  ì„ íƒ ê¸°ëŠ¥ (dâ‚~dâ‚„)<br>
                        - âš¡ ì–‘ë°©í–¥ ì „íŒŒ ì‹œë®¬ë ˆì´ì…˜<br>
                        - ğŸ“¸ ë°ì´í„° ìº¡ì²˜ ê¸°ëŠ¥<br>
                    </div>
                </div>

                <div class="help-section">
                    <div class="log-date" style="color: #3d4e9f; font-weight: bold; font-size: 1.1em; margin-bottom: 10px;">2025. 10. 26. (ì¼)</div>
                    <div class="log-text">
                        <strong>v1.0 ì¶œì‹œ</strong><br>
                        ì‹ ê²½ì„¸í¬ ë§‰ì „ìœ„ ì‹œë®¬ë ˆì´í„° ìµœì´ˆ ê³µê°œ.
                    </div>
                </div>

                <div class="help-section">
                    <div class="log-date" style="color: #3d4e9f; font-weight: bold; font-size: 1.1em; margin-bottom: 10px;">Â©ï¸ ì €ì‘ê¶Œ ì •ë³´</div>
                    <div class="log-text">
                        <strong>ì‹ ê²½ì„¸í¬ ë§‰ì „ìœ„ ì‹œë®¬ë ˆì´í„° v3.0</strong><br><br>
                        â“’ 2025-2026 ì¶©ë‚¨ì‚¼ì„±ê³ ë“±í•™êµ ì‹ ë„ê²½ êµì‚¬<br>
                        ì´ë©”ì¼: <a href="mailto:pantarei01@cnsa.hs.kr">pantarei01@cnsa.hs.kr</a><br><br>
                        ë³¸ í”„ë¡œê·¸ë¨ì€ êµìœ¡ ëª©ì ìœ¼ë¡œ ì œì‘ë˜ì—ˆìœ¼ë©°, ììœ ë¡­ê²Œ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                        ìƒì—…ì  ì´ìš© ì‹œì—ëŠ” ì œì‘ìì—ê²Œ ë¬¸ì˜í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getVoltageAtTime(delay, currentTime) {
            const t = currentTime - delay;
            if (t < 0 || t > 4) return -70;

            if (t <= 1) {
                const p = t;
                return -70 + 20 * p * p * p;
            } else if (t <= 2) {
                const p = t - 1;
                const k = 10;
                const raw = 1 / (1 + Math.exp(-k * (p - 0.5)));
                const s0 = 1 / (1 + Math.exp(-k * (0 - 0.5)));
                const s1 = 1 / (1 + Math.exp(-k * (1 - 0.5)));
                const s = (raw - s0) / (s1 - s0);
                return -50 + 80 * s;
            } else if (t <= 3) {
                const p = t - 2;
                const k = 10;
                const raw = 1 / (1 + Math.exp(-k * (p - 0.5)));
                const s0 = 1 / (1 + Math.exp(-k * (0 - 0.5)));
                const s1 = 1 / (1 + Math.exp(-k * (1 - 0.5)));
                const s = (raw - s0) / (s1 - s0);
                return 30 - 110 * s;
            } else {
                const p = t - 3;
                return -80 + 10 * (1 - Math.exp(-3 * p));
            }
        }

        function createMembraneData(delay, maxTime) {
            const data = [];
            const steps = Math.round(maxTime / 0.1);
            for (let i = 0; i <= steps; i++) {
                const time = +(i * 0.1).toFixed(1);
                const voltage = +getVoltageAtTime(delay, time).toFixed(2);
                data.push({ time, voltage });
            }
            return data;
        }

        const distances = [0, 2, 4, 6];
        const chartColors = ['#0066cc', '#fd7e14', '#28a745', '#dc3545'];
        const charts = [];
        let currentTime = 0;
        let speed = 2;
        let stimulationPoint = 0;
        let capturedData = [];
        let cachedData = [];
        let cachedDelays = [];
        let sliderMax = 8;
        let animationId = null;
        let isPlaying = false;
        let lastFrameTime = 0;

        function computeSliderMax() {
            const maxDelay = Math.max(...cachedDelays);
            return Math.max(8, Math.ceil(maxDelay + 5));
        }

        function rebuildCache() {
            cachedDelays = distances.map(distance =>
                Math.abs(distances[stimulationPoint] - distance) / speed
            );
            sliderMax = computeSliderMax();
            cachedData = cachedDelays.map(delay => createMembraneData(delay, sliderMax));

            const slider = document.getElementById('timeSlider');
            slider.max = sliderMax;
            if (currentTime > sliderMax) {
                currentTime = sliderMax;
                slider.value = sliderMax;
            }
        }

        function getVoltageColor(voltage, delay, currentTime) {
            const localTime = currentTime - delay;

            if (localTime < 0) {
                return '#6c757d';
            }

            if (Math.abs(voltage - (-70)) <= 2 && (localTime < 0.1 || localTime > 3.8)) {
                return '#6c757d';
            }

            if (voltage < -72) {
                return '#0066cc';
            }

            const prevVoltage = getVoltageAtTime(delay, currentTime - 0.1);
            const rising = voltage >= prevVoltage;

            if (rising) {
                return '#dc3545';
            }
            return '#28a745';
        }

        function updateSparkPosition() {
            const spark1 = document.getElementById('spark1');
            const spark2 = document.getElementById('spark2');

            const markerPositions = [250, 430, 610, 790];
            const stimPos = markerPositions[stimulationPoint];
            const stimDist = distances[stimulationPoint];

            const traveled = currentTime * speed;

            if (stimulationPoint === 0) {
                if (traveled <= 6) {
                    const xPos = stimPos + (traveled / 6) * (markerPositions[3] - markerPositions[0]);
                    spark1.setAttribute('transform', `translate(${xPos}, 75)`);
                    spark1.style.display = 'block';
                } else {
                    spark1.style.display = 'none';
                }
                spark2.style.display = 'none';
            } else if (stimulationPoint === 3) {
                if (traveled <= 6) {
                    const xPos = stimPos - (traveled / 6) * (markerPositions[3] - markerPositions[0]);
                    spark1.setAttribute('transform', `translate(${xPos}, 75)`);
                    spark1.style.display = 'block';
                } else {
                    spark1.style.display = 'none';
                }
                spark2.style.display = 'none';
            } else {
                if (traveled <= stimDist) {
                    const xPos = stimPos - (traveled / 6) * (markerPositions[3] - markerPositions[0]);
                    spark1.setAttribute('transform', `translate(${xPos}, 75)`);
                    spark1.style.display = 'block';
                } else {
                    spark1.style.display = 'none';
                }
                if (traveled <= 6 - stimDist) {
                    const xPos = stimPos + (traveled / 6) * (markerPositions[3] - markerPositions[0]);
                    spark2.setAttribute('transform', `translate(${xPos}, 75)`);
                    spark2.style.display = 'block';
                } else {
                    spark2.style.display = 'none';
                }
            }
        }

        function updateSimulation() {
            document.getElementById('timeDisplay').textContent = `${currentTime.toFixed(1)} ms`;
            document.getElementById('tableTime').textContent = `${currentTime.toFixed(1)} ms`;

            updateSparkPosition();

            distances.forEach((distance, index) => {
                const delay = cachedDelays[index];
                const voltage = +getVoltageAtTime(delay, currentTime).toFixed(2);
                const voltageColor = getVoltageColor(voltage, delay, currentTime);

                const voltageElem = document.getElementById(`voltage${index}`);
                voltageElem.textContent = `${voltage} mV`;
                voltageElem.style.color = voltageColor;

                const tableVoltageElem = document.getElementById(`tableVoltage${index}`);
                if (tableVoltageElem) {
                    tableVoltageElem.textContent = voltage.toFixed(1);
                    tableVoltageElem.style.color = voltageColor;
                }

                const timeElem = document.getElementById(`time${index}`);
                if (currentTime >= delay) {
                    timeElem.textContent = `${(currentTime - delay).toFixed(1)} ms`;
                } else {
                    timeElem.textContent = 'ë„ë‹¬ ì „';
                }

                const graphBox = document.getElementById(`graph${index}`);
                if (!graphBox.classList.contains('graph-hidden')) {
                    const data = cachedData[index];
                    const timeIndex = Math.round(currentTime / 0.1);
                    const clampedIndex = Math.min(timeIndex, data.length - 1);
                    if (clampedIndex >= 0) {
                        charts[index].data.datasets[0].pointRadius = data.map((_, i) => i === clampedIndex ? 8 : 0);
                        charts[index].update('none');
                    }
                }
            });
        }

        function reset() {
            if (isPlaying) {
                cancelAnimationFrame(animationId);
                animationId = null;
                isPlaying = false;
                const btn = document.getElementById('playBtn');
                btn.textContent = 'â–¶ ì¬ìƒ';
                btn.classList.remove('playing');
            }

            currentTime = 0;
            speed = parseFloat(document.getElementById('speedInput').value);
            stimulationPoint = parseInt(document.getElementById('stimulationPoint').value);
            document.getElementById('timeSlider').value = 0;
            capturedData = [];

            rebuildCache();

            distances.forEach((distance, index) => {
                charts[index].data.labels = cachedData[index].map(d => d.time);
                charts[index].data.datasets[0].data = cachedData[index].map(d => d.voltage);
                charts[index].data.datasets[0].pointRadius = 0;
                charts[index].update();
            });

            renderTable();
            updateSimulation();
        }

        function toggleAnimation() {
            const btn = document.getElementById('playBtn');
            if (isPlaying) {
                cancelAnimationFrame(animationId);
                animationId = null;
                isPlaying = false;
                btn.textContent = 'â–¶ ì¬ìƒ';
                btn.classList.remove('playing');
            } else {
                isPlaying = true;
                btn.textContent = 'â¸ ì¼ì‹œì •ì§€';
                btn.classList.add('playing');
                lastFrameTime = performance.now();
                animationId = requestAnimationFrame(animateStep);
            }
        }

        function animateStep(timestamp) {
            const elapsed = timestamp - lastFrameTime;
            if (elapsed >= 16) {
                lastFrameTime = timestamp;
                const slider = document.getElementById('timeSlider');
                currentTime += 0.05;
                if (currentTime >= sliderMax) {
                    currentTime = sliderMax;
                    slider.value = sliderMax;
                    updateSimulation();
                    cancelAnimationFrame(animationId);
                    animationId = null;
                    isPlaying = false;
                    const btn = document.getElementById('playBtn');
                    btn.textContent = 'â–¶ ì¬ìƒ';
                    btn.classList.remove('playing');
                    return;
                }
                currentTime = parseFloat(currentTime.toFixed(2));
                slider.value = currentTime;
                updateSimulation();
            }
            animationId = requestAnimationFrame(animateStep);
        }

        function captureData() {
            const captured = {
                time: currentTime.toFixed(1),
                voltages: [],
                colors: []
            };

            distances.forEach((distance, index) => {
                const delay = cachedDelays[index];
                const voltage = +getVoltageAtTime(delay, currentTime).toFixed(2);
                const color = getVoltageColor(voltage, delay, currentTime);
                captured.voltages.push(voltage.toFixed(1));
                captured.colors.push(color);
            });

            capturedData.push(captured);
            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            capturedData.forEach((capture, idx) => {
                const row = document.createElement('tr');
                row.className = 'captured-row';
                row.innerHTML = `
                    <td class="time-cell">${capture.time} ms</td>
                    <td class="voltage-cell" style="color: ${capture.colors[0]}; font-weight: bold;">${capture.voltages[0]}</td>
                    <td class="voltage-cell" style="color: ${capture.colors[1]}; font-weight: bold;">${capture.voltages[1]}</td>
                    <td class="voltage-cell" style="color: ${capture.colors[2]}; font-weight: bold;">${capture.voltages[2]}</td>
                    <td class="voltage-cell" style="color: ${capture.colors[3]}; font-weight: bold;">${capture.voltages[3]}</td>
                    <td><button class="delete-btn" onclick="deleteCapture(${idx})">âŒ</button></td>
                `;
                tbody.appendChild(row);
            });

            const liveRow = document.createElement('tr');
            liveRow.className = 'live-row';
            liveRow.innerHTML = `
                <td class="time-cell" id="tableTime">${currentTime.toFixed(1)} ms</td>
                <td class="voltage-cell" id="tableVoltage0">-70.0</td>
                <td class="voltage-cell" id="tableVoltage1">-70.0</td>
                <td class="voltage-cell" id="tableVoltage2">-70.0</td>
                <td class="voltage-cell" id="tableVoltage3">-70.0</td>
                <td>-</td>
            `;
            tbody.appendChild(liveRow);
            updateSimulation();
        }

        function deleteCapture(index) {
            capturedData.splice(index, 1);
            renderTable();
        }

        function showHelp() { document.getElementById('helpModal').style.display = 'block'; }
        function closeHelp() { document.getElementById('helpModal').style.display = 'none'; }
        function showDevLog() { document.getElementById('devLogModal').style.display = 'block'; }
        function closeDevLog() { document.getElementById('devLogModal').style.display = 'none'; }

        window.onclick = function(event) {
            if (event.target === document.getElementById('helpModal')) closeHelp();
            if (event.target === document.getElementById('devLogModal')) closeDevLog();
        }

        rebuildCache();

        distances.forEach((distance, index) => {
            const ctx = document.getElementById(`chart${index}`).getContext('2d');
            const data = cachedData[index];

            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.time),
                    datasets: [{
                        label: 'ë§‰ì „ìœ„ (mV)',
                        data: data.map(d => d.voltage),
                        borderColor: chartColors[index],
                        backgroundColor: `${chartColors[index]}20`,
                        borderWidth: 3,
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.2,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: true, titleFont: { size: 9 }, bodyFont: { size: 9 } }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'ì‹œê°„ (ms)', font: { size: 9, weight: 'bold' } },
                            ticks: {
                                font: { size: 7 },
                                stepSize: 1,
                                callback: function(value) {
                                    const label = this.getLabelForValue(value);
                                    return label % 1 === 0 ? label : '';
                                }
                            }
                        },
                        y: {
                            title: { display: true, text: 'ë§‰ì „ìœ„ (mV)', font: { size: 9, weight: 'bold' } },
                            ticks: { font: { size: 7 } },
                            min: -100,
                            max: 50
                        }
                    }
                }
            });
            charts.push(chart);
        });

        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                charts.forEach(chart => chart.resize());
            }, 100);
        });

        document.getElementById('helpBtn').addEventListener('click', showHelp);
        document.getElementById('devLogBtn').addEventListener('click', showDevLog);
        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('playBtn').addEventListener('click', toggleAnimation);
        document.getElementById('speedInput').addEventListener('change', reset);
        document.getElementById('stimulationPoint').addEventListener('change', reset);

        document.getElementById('timeSlider').addEventListener('input', (e) => {
            currentTime = parseFloat(e.target.value);
            updateSimulation();
        });

        document.querySelectorAll('.graph-toggle').forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                const index = parseInt(e.target.dataset.index);
                const graphBox = document.getElementById(`graph${index}`);
                if (e.target.checked) {
                    graphBox.classList.remove('graph-hidden');
                } else {
                    graphBox.classList.add('graph-hidden');
                }
            });
        });

        updateSimulation();
    </script>
</body>
</html>
