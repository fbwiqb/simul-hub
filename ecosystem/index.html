<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡±ë ˆì´í¬ ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2em;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        .control-panel {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #3498db;
            color: white;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3);
        }
        
        .danger-btn {
            background: #e74c3c;
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }

        .danger-btn:hover {
            background: #c0392b;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
        }
        
        .success-btn {
            background: #27ae60;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }

        .success-btn:hover {
            background: #229954;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.4);
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .simulation-area {
            background: #ecf0f1;
            border-radius: 10px;
            padding: 15px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        
        canvas {
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            width: 100%;
            height: auto;
            background: rgba(200, 230, 250, 0.3);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .info-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .monitor {
            background: white;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.06);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .monitor:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .monitor-label {
            font-weight: bold;
            color: #34495e;
        }
        
        .monitor-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .zoo-value { color: #3498db; }
        .fish-value { color: #f39c12; }
        .bass-value { color: #e74c3c; }
        .phyto-value { color: #27ae60; }
        
        .phase-monitor {
            background: linear-gradient(135deg, #667eea20, #764ba220);
            padding: 16px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.1em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .speed-slider {
            flex: 1;
            cursor: pointer;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
        }
        
        .graph-container {
            background: white;
            border-radius: 8px;
            padding: 10px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 10px;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŸ ë¡±ë ˆì´í¬ ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜</h1>
        
        <div class="control-panel">
            <button onclick="setup()" class="success-btn">ì´ˆê¸° ì„¤ì •</button>
            <button onclick="toggleGo()">ì‹¤í–‰/ì •ì§€</button>
            <button onclick="removeAllBass()" class="danger-btn">ë°°ìŠ¤ ì „ì²´ ì œê±°</button>
            <button onclick="addBass(5)">ë°°ìŠ¤ 5ë§ˆë¦¬ ì¶”ê°€</button>
            <button onclick="addFish(10)">ë¬¼ê³ ê¸° 10ë§ˆë¦¬ ì¶”ê°€</button>
            <button onclick="resetGraph()">ê·¸ë˜í”„ ì´ˆê¸°í™”</button>
        </div>
        
        <div class="main-grid">
            <div class="simulation-area">
                <canvas id="worldCanvas" width="600" height="400"></canvas>
                <div class="speed-control">
                    <label>ì†ë„:</label>
                    <input type="range" class="speed-slider" min="1" max="100" value="50" id="speedSlider">
                    <span id="speedValue">50</span>
                </div>
                <canvas id="graphCanvas" width="600" height="200"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <span>ë™ë¬¼í”Œë‘í¬í†¤</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f39c12;"></div>
                        <span>ì‘ì€ë¬¼ê³ ê¸°</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e74c3c;"></div>
                        <span>ë°°ìŠ¤</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #27ae60;"></div>
                        <span>ì‹ë¬¼í”Œë‘í¬í†¤</span>
                    </div>
                </div>
            </div>
            
            <div class="info-panel">
                <div class="phase-monitor" id="phaseMonitor">í‰í˜• ìƒíƒœ</div>
                
                <div class="monitor">
                    <span class="monitor-label">ë™ë¬¼í”Œë‘í¬í†¤</span>
                    <span class="monitor-value zoo-value" id="zooCount">0</span>
                </div>
                
                <div class="monitor">
                    <span class="monitor-label">ì‘ì€ ë¬¼ê³ ê¸°</span>
                    <span class="monitor-value fish-value" id="fishCount">0</span>
                </div>
                
                <div class="monitor">
                    <span class="monitor-label">ë°°ìŠ¤</span>
                    <span class="monitor-value bass-value" id="bassCount">0</span>
                </div>
                
                <div class="monitor">
                    <span class="monitor-label">ì‹ë¬¼í”Œë‘í¬í†¤</span>
                    <span class="monitor-value phyto-value" id="phytoCount">0</span>
                </div>
                
                <h3 style="margin-top: 20px; color: #2c3e50;">ì‹œë®¬ë ˆì´ì…˜ ì„¤ëª…</h3>
                <p style="margin-top: 10px; color: #555; line-height: 1.6;">
                    ì´ ì‹œë®¬ë ˆì´ì…˜ì€ ë¯¸ì‹œê°„ì£¼ ë¡±ë ˆì´í¬ì˜ ì˜ì–‘ë‹¨ê³„ ì—°ì‡„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
                    ë°°ìŠ¤ë¥¼ ì œê±°í•˜ë©´ ì‘ì€ë¬¼ê³ ê¸°ê°€ í­ì¦í•˜ê³ , 
                    ì´ëŠ” ë™ë¬¼í”Œë‘í¬í†¤ ê°ì†Œì™€ ì‹ë¬¼í”Œë‘í¬í†¤ í­ë°œ(ë…¹ì¡°)ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>
    
    <script>
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const worldCanvas = document.getElementById('worldCanvas');
        const worldCtx = worldCanvas.getContext('2d');
        const graphCanvas = document.getElementById('graphCanvas');
        const graphCtx = graphCanvas.getContext('2d');
        
        // ì „ì—­ ë³€ìˆ˜
        let isRunning = false;
        let ticks = 0;
        let speed = 50;
        let animationId = null;
        let initialBassCount = 0;
        
        // ê°œì²´ ë°°ì—´
        let zooplankton = [];
        let smallFish = [];
        let bass = [];
        let patches = [];
        
        // ê·¸ë˜í”„ ë°ì´í„°
        let history = {
            zoo: [],
            fish: [],
            bass: [],
            phyto: []
        };
        
        // íŒ¨ì¹˜ í´ë˜ìŠ¤ (ì‹ë¬¼í”Œë‘í¬í†¤)
        class Patch {
            constructor(x, y, size) {
                this.x = x;
                this.y = y;
                this.size = size;
                this.phytoplankton = 5;
            }
            
            update() {
                // ì‹ë¬¼í”Œë‘í¬í†¤ ì¬ìƒ
                this.phytoplankton += 0.05;
                if (this.phytoplankton > 10) this.phytoplankton = 10;
            }
            
            draw() {
                const intensity = this.phytoplankton / 10;
                const greenValue = Math.floor(100 + intensity * 100);
                worldCtx.fillStyle = `rgba(0, ${greenValue}, 50, 0.3)`;
                worldCtx.fillRect(this.x, this.y, this.size, this.size);
            }
        }
        
        // ë™ë¬¼í”Œë‘í¬í†¤ í´ë˜ìŠ¤
        class Zooplankton {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.energy = 10;
                this.age = 0;
                this.angle = Math.random() * Math.PI * 2;
            }
            
            update() {
                // ì‹ë¬¼í”Œë‘í¬í†¤ì´ ë§ì€ ê³³ìœ¼ë¡œ ì´ë™
                const patchSize = 20;
                const px = Math.floor(this.x / patchSize);
                const py = Math.floor(this.y / patchSize);
                
                if (patches[py] && patches[py][px]) {
                    const currentPatch = patches[py][px];
                    
                    // ì‹ë¬¼í”Œë‘í¬í†¤ ì„­ì·¨
                    if (currentPatch.phytoplankton > 0) {
                        const eaten = Math.min(0.1, currentPatch.phytoplankton);
                        currentPatch.phytoplankton -= eaten;
                        this.energy += eaten * 20;
                    }
                }
                
                // ì´ë™
                this.angle += (Math.random() - 0.5) * 0.5;
                this.x += Math.cos(this.angle) * 0.3;
                this.y += Math.sin(this.angle) * 0.3;
                
                // ê²½ê³„ ì²˜ë¦¬
                if (this.x < 0) this.x = worldCanvas.width;
                if (this.x > worldCanvas.width) this.x = 0;
                if (this.y < 0) this.y = worldCanvas.height;
                if (this.y > worldCanvas.height) this.y = 0;
                
                // ëŒ€ì‚¬
                this.energy -= 0.1;
                this.age++;
                
                // ë²ˆì‹
                if (this.energy > 15 && Math.random() < 0.05) {
                    zooplankton.push(new Zooplankton(this.x + Math.random() * 10 - 5, this.y + Math.random() * 10 - 5));
                    this.energy -= 5;
                }
            }
            
            draw() {
                worldCtx.fillStyle = 'rgba(52, 152, 219, 0.8)';
                worldCtx.beginPath();
                worldCtx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                worldCtx.fill();
            }
            
            isDead() {
                return this.energy <= 0 || this.age > 300;
            }
        }
        
        // ì‘ì€ë¬¼ê³ ê¸° í´ë˜ìŠ¤
        class SmallFish {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.energy = 20;
                this.age = 0;
                this.angle = Math.random() * Math.PI * 2;
            }
            
            update() {
                // ê°€ì¥ ê°€ê¹Œìš´ ë™ë¬¼í”Œë‘í¬í†¤ ì°¾ê¸°
                if (this.energy < 15 && zooplankton.length > 0) {
                    let nearest = null;
                    let minDist = Infinity;
                    
                    for (let zoo of zooplankton) {
                        const dist = Math.hypot(zoo.x - this.x, zoo.y - this.y);
                        if (dist < minDist && dist < 50) {
                            minDist = dist;
                            nearest = zoo;
                        }
                    }
                    
                    if (nearest) {
                        this.angle = Math.atan2(nearest.y - this.y, nearest.x - this.x);
                        
                        // í¬ì‹
                        if (minDist < 5) {
                            const index = zooplankton.indexOf(nearest);
                            if (index > -1) {
                                zooplankton.splice(index, 1);
                                this.energy += 5;
                            }
                        }
                    }
                }
                
                // ì´ë™
                this.x += Math.cos(this.angle) * 0.5;
                this.y += Math.sin(this.angle) * 0.5;
                this.angle += (Math.random() - 0.5) * 0.3;
                
                // ê²½ê³„ ì²˜ë¦¬
                if (this.x < 0) this.x = worldCanvas.width;
                if (this.x > worldCanvas.width) this.x = 0;
                if (this.y < 0) this.y = worldCanvas.height;
                if (this.y > worldCanvas.height) this.y = 0;
                
                // ëŒ€ì‚¬
                this.energy -= 0.15;
                this.age++;
                
                // ë²ˆì‹
                if (this.energy > 25 && Math.random() < 0.03) {
                    smallFish.push(new SmallFish(this.x + Math.random() * 20 - 10, this.y + Math.random() * 20 - 10));
                    this.energy -= 10;
                }
            }
            
            draw() {
                worldCtx.save();
                worldCtx.translate(this.x, this.y);
                worldCtx.rotate(this.angle);
                
                // ë¬¼ê³ ê¸° ëª¸ì²´
                worldCtx.fillStyle = 'rgba(243, 156, 18, 0.9)';
                worldCtx.beginPath();
                worldCtx.ellipse(0, 0, 6, 3, 0, 0, Math.PI * 2);
                worldCtx.fill();
                
                // ê¼¬ë¦¬
                worldCtx.beginPath();
                worldCtx.moveTo(-6, 0);
                worldCtx.lineTo(-10, -3);
                worldCtx.lineTo(-10, 3);
                worldCtx.closePath();
                worldCtx.fill();
                
                worldCtx.restore();
            }
            
            isDead() {
                return this.energy <= 0 || this.age > 400;
            }
        }
        
        // ë°°ìŠ¤ í´ë˜ìŠ¤
        class Bass {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.energy = 30;
                this.age = 0;
                this.angle = Math.random() * Math.PI * 2;
            }
            
            update() {
                // ê°€ì¥ ê°€ê¹Œìš´ ì‘ì€ë¬¼ê³ ê¸° ì°¾ê¸°
                if (this.energy < 20 && smallFish.length > 0) {
                    let nearest = null;
                    let minDist = Infinity;
                    
                    for (let fish of smallFish) {
                        const dist = Math.hypot(fish.x - this.x, fish.y - this.y);
                        if (dist < minDist && dist < 60) {
                            minDist = dist;
                            nearest = fish;
                        }
                    }
                    
                    if (nearest) {
                        this.angle = Math.atan2(nearest.y - this.y, nearest.x - this.x);
                        
                        // í¬ì‹
                        if (minDist < 8) {
                            const index = smallFish.indexOf(nearest);
                            if (index > -1) {
                                smallFish.splice(index, 1);
                                this.energy += 10;
                            }
                        }
                    }
                }
                
                // ì´ë™
                this.x += Math.cos(this.angle) * 0.4;
                this.y += Math.sin(this.angle) * 0.4;
                this.angle += (Math.random() - 0.5) * 0.2;
                
                // ê²½ê³„ ì²˜ë¦¬
                if (this.x < 0) this.x = worldCanvas.width;
                if (this.x > worldCanvas.width) this.x = 0;
                if (this.y < 0) this.y = worldCanvas.height;
                if (this.y > worldCanvas.height) this.y = 0;
                
                // ëŒ€ì‚¬
                this.energy -= 0.2;
                this.age++;
                
                // ë²ˆì‹
                if (this.energy > 35 && Math.random() < 0.02) {
                    bass.push(new Bass(this.x + Math.random() * 30 - 15, this.y + Math.random() * 30 - 15));
                    this.energy -= 15;
                }
            }
            
            draw() {
                worldCtx.save();
                worldCtx.translate(this.x, this.y);
                worldCtx.rotate(this.angle);
                
                // ë°°ìŠ¤ ëª¸ì²´
                worldCtx.fillStyle = 'rgba(231, 76, 60, 1)';
                worldCtx.beginPath();
                worldCtx.ellipse(0, 0, 10, 5, 0, 0, Math.PI * 2);
                worldCtx.fill();
                
                // ê¼¬ë¦¬
                worldCtx.beginPath();
                worldCtx.moveTo(-10, 0);
                worldCtx.lineTo(-15, -5);
                worldCtx.lineTo(-15, 5);
                worldCtx.closePath();
                worldCtx.fill();
                
                worldCtx.restore();
            }
            
            isDead() {
                return this.energy <= 0 || this.age > 500;
            }
        }
        
        // ì´ˆê¸° ì„¤ì •
        function setup() {
            // ì´ˆê¸°í™”
            zooplankton = [];
            smallFish = [];
            bass = [];
            patches = [];
            history = { zoo: [], fish: [], bass: [], phyto: [] };
            ticks = 0;
            
            // íŒ¨ì¹˜ ìƒì„± (ì‹ë¬¼í”Œë‘í¬í†¤ í™˜ê²½)
            const patchSize = 20;
            for (let y = 0; y < worldCanvas.height / patchSize; y++) {
                patches[y] = [];
                for (let x = 0; x < worldCanvas.width / patchSize; x++) {
                    patches[y][x] = new Patch(x * patchSize, y * patchSize, patchSize);
                }
            }
            
            // ë™ë¬¼í”Œë‘í¬í†¤ ìƒì„±
            for (let i = 0; i < 100; i++) {
                zooplankton.push(new Zooplankton(
                    Math.random() * worldCanvas.width,
                    Math.random() * worldCanvas.height
                ));
            }
            
            // ì‘ì€ë¬¼ê³ ê¸° ìƒì„±
            for (let i = 0; i < 30; i++) {
                smallFish.push(new SmallFish(
                    Math.random() * worldCanvas.width,
                    Math.random() * worldCanvas.height
                ));
            }
            
            // ë°°ìŠ¤ ìƒì„±
            for (let i = 0; i < 8; i++) {
                bass.push(new Bass(
                    Math.random() * worldCanvas.width,
                    Math.random() * worldCanvas.height
                ));
            }
            
            initialBassCount = bass.length;
            updateMonitors();
        }
        
        // ì‹¤í–‰/ì •ì§€
        function toggleGo() {
            isRunning = !isRunning;
            if (isRunning) {
                go();
            }
        }
        
        // ë©”ì¸ ë£¨í”„
        function go() {
            if (!isRunning) return;
            
            // íŒ¨ì¹˜ ì—…ë°ì´íŠ¸
            for (let row of patches) {
                for (let patch of row) {
                    patch.update();
                }
            }
            
            // ì£½ì€ ê°œì²´ ì œê±°
            zooplankton = zooplankton.filter(z => !z.isDead());
            smallFish = smallFish.filter(f => !f.isDead());
            bass = bass.filter(b => !b.isDead());
            
            // ê°œì²´ ì—…ë°ì´íŠ¸
            zooplankton.forEach(z => z.update());
            smallFish.forEach(f => f.update());
            bass.forEach(b => b.update());
            
            // ê·¸ë¦¬ê¸°
            draw();
            
            // ëª¨ë‹ˆí„° ì—…ë°ì´íŠ¸
            if (ticks % 10 === 0) {
                updateMonitors();
                updateGraph();
            }
            
            ticks++;
            
            // ë‹¤ìŒ í”„ë ˆì„
            setTimeout(() => go(), 1000 / speed);
        }
        
        // ê·¸ë¦¬ê¸°
        function draw() {
            worldCtx.clearRect(0, 0, worldCanvas.width, worldCanvas.height);
            
            // íŒ¨ì¹˜ ê·¸ë¦¬ê¸°
            for (let row of patches) {
                for (let patch of row) {
                    patch.draw();
                }
            }
            
            // ê°œì²´ ê·¸ë¦¬ê¸°
            zooplankton.forEach(z => z.draw());
            smallFish.forEach(f => f.draw());
            bass.forEach(b => b.draw());
        }
        
        // ëª¨ë‹ˆí„° ì—…ë°ì´íŠ¸
        function updateMonitors() {
            document.getElementById('zooCount').textContent = zooplankton.length;
            document.getElementById('fishCount').textContent = smallFish.length;
            document.getElementById('bassCount').textContent = bass.length;
            
            let phytoTotal = 0;
            for (let row of patches) {
                for (let patch of row) {
                    phytoTotal += patch.phytoplankton;
                }
            }
            document.getElementById('phytoCount').textContent = Math.round(phytoTotal);
            
            // ìƒíƒœê³„ ë‹¨ê³„ ì—…ë°ì´íŠ¸
            updatePhase();
        }
        
        // ìƒíƒœê³„ ë‹¨ê³„ íŒë‹¨
        function updatePhase() {
            const bassRatio = initialBassCount > 0 ? bass.length / initialBassCount : 0;
            const fishCount = smallFish.length;
            const zooCount = zooplankton.length;
            
            let phase = "í‰í˜• ìƒíƒœ";
            
            if (bassRatio === 0 && fishCount > 60) {
                phase = "ì‘ì€ë¬¼ê³ ê¸° í­ì¦!";
            } else if (bassRatio === 0 && zooCount < 30) {
                phase = "ë™ë¬¼í”Œë‘í¬í†¤ ê³ ê°ˆ!";
            } else if (bassRatio === 0 && fishCount > 100) {
                phase = "ë…¹ì¡° ëŒ€ë°œìƒ!";
            } else if (bassRatio < 0.5 && bassRatio > 0) {
                phase = "ë°°ìŠ¤ ê°ì†Œ ì¤‘";
            }
            
            document.getElementById('phaseMonitor').textContent = phase;
        }
        
        // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
        function updateGraph() {
            // ë°ì´í„° ì¶”ê°€
            history.zoo.push(zooplankton.length);
            history.fish.push(smallFish.length);
            history.bass.push(bass.length);
            
            let phytoTotal = 0;
            for (let row of patches) {
                for (let patch of row) {
                    phytoTotal += patch.phytoplankton;
                }
            }
            history.phyto.push(phytoTotal / 10);
            
            // ë°ì´í„° ì œí•œ
            const maxPoints = 200;
            if (history.zoo.length > maxPoints) {
                history.zoo.shift();
                history.fish.shift();
                history.bass.shift();
                history.phyto.shift();
            }
            
            // ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            graphCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
            
            // ì¶•
            graphCtx.strokeStyle = '#34495e';
            graphCtx.lineWidth = 2;
            graphCtx.beginPath();
            graphCtx.moveTo(30, 10);
            graphCtx.lineTo(30, 170);
            graphCtx.lineTo(580, 170);
            graphCtx.stroke();
            
            // ë°ì´í„° ì„ 
            const colors = {
                zoo: '#3498db',
                fish: '#f39c12',
                bass: '#e74c3c',
                phyto: '#27ae60'
            };
            
            Object.keys(history).forEach(key => {
                graphCtx.strokeStyle = colors[key];
                graphCtx.lineWidth = 2;
                graphCtx.beginPath();
                
                history[key].forEach((value, index) => {
                    const x = 30 + (index / maxPoints) * 550;
                    const y = 170 - (value / 200) * 150;
                    
                    if (index === 0) {
                        graphCtx.moveTo(x, y);
                    } else {
                        graphCtx.lineTo(x, y);
                    }
                });
                
                graphCtx.stroke();
            });
        }
        
        // ë°°ìŠ¤ ì œê±°
        function removeAllBass() {
            bass = [];
            updateMonitors();
        }
        
        // ë°°ìŠ¤ ì¶”ê°€
        function addBass(n) {
            for (let i = 0; i < n; i++) {
                bass.push(new Bass(
                    Math.random() * worldCanvas.width,
                    Math.random() * worldCanvas.height
                ));
            }
            updateMonitors();
        }
        
        // ë¬¼ê³ ê¸° ì¶”ê°€
        function addFish(n) {
            for (let i = 0; i < n; i++) {
                smallFish.push(new SmallFish(
                    Math.random() * worldCanvas.width,
                    Math.random() * worldCanvas.height
                ));
            }
            updateMonitors();
        }
        
        // ê·¸ë˜í”„ ì´ˆê¸°í™”
        function resetGraph() {
            history = { zoo: [], fish: [], bass: [], phyto: [] };
        }
        
        // ì†ë„ ì¡°ì ˆ
        document.getElementById('speedSlider').addEventListener('input', function(e) {
            speed = parseInt(e.target.value);
            document.getElementById('speedValue').textContent = speed;
        });
        
        // ì´ˆê¸° ì‹¤í–‰
        setup();
    </script>
</body>
</html>
