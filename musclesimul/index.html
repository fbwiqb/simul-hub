<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¼ìœ¡ ìˆ˜ì¶• ìŠ¬ë¼ì´ë”© í•„ë¼ë©˜íŠ¸ ì‹œë®¬ë ˆì´í„°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #004999 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        h2 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #0066cc;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #0066cc;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0052a3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,102,204,0.3);
        }
        
        .control-panel {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            border: 2px solid #0066cc;
        }
        
        .control-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 18px;
            color: #0066cc;
        }
        
        .length-value {
            color: #0066cc;
            font-size: 22px;
            font-weight: bold;
        }
        
        .delta-display {
            color: #666;
            font-size: 16px;
            margin-left: 8px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #cce5ff;
            border-radius: 4px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #0066cc;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,102,204,0.5);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #0066cc;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0,102,204,0.5);
        }
        
        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }
        
        .svg-container {
            background: white;
            border: 2px solid #0066cc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            overflow-x: auto;
        }
        
        svg {
            display: block;
            margin: 0 auto;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }
        
        .info-card {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #0066cc;
        }
        
        .info-card h4 {
            font-weight: bold;
            margin-bottom: 12px;
            color: #0066cc;
        }
        
        .info-card ul {
            list-style: disc;
            margin-left: 20px;
            line-height: 1.8;
        }
        
        .delta-positive {
            color: #28a745;
        }
        
        .delta-negative {
            color: #dc3545;
        }
        
        .delta-info {
            color: #0066cc;
        }
        
        .calculator {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #0066cc;
            margin-bottom: 32px;
        }
        
        .calculator h4 {
            font-weight: bold;
            margin-bottom: 16px;
            color: #0066cc;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th, td {
            border: 1px solid #0066cc;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #0066cc;
            color: white;
            font-weight: 600;
        }
        
        td:nth-child(4) {
            text-align: center;
            font-weight: bold;
        }
        
        select {
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 2px solid #0066cc;
            font-size: 14px;
        }
        
        .operator-select {
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 2px solid #0066cc;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            background: #f0f7ff;
        }
        
        footer {
            margin-top: 40px;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 8px;
            border: 2px solid #0066cc;
            text-align: center;
        }
        
        .footer-content {
            margin-bottom: 10px;
            color: #333;
        }
        
        .developer-log {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border: 2px solid #0066cc;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #0066cc;
        }
        
        .modal-header h3 {
            color: #0066cc;
            font-size: 22px;
        }
        
        .close {
            color: #666;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: #0066cc;
        }
        
        .modal-body {
            line-height: 1.8;
            color: #333;
        }
        
        .modal-body h4 {
            color: #0066cc;
            margin: 20px 0 10px 0;
            font-size: 18px;
        }
        
        .modal-body ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .modal-body li {
            margin-bottom: 8px;
        }
        
        .modal-body strong {
            color: #0066cc;
        }
        
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>ğŸ”¬ ê·¼ìœ¡ ìˆ˜ì¶• ìŠ¬ë¼ì´ë”© í•„ë¼ë©˜íŠ¸ ì‹œë®¬ë ˆì´í„°</h2>
        </div>

        <div class="button-group">
            <button class="btn" onclick="openModal('theory')">ğŸ“– ì´ë¡  ì„¤ëª…</button>
            <button class="btn" onclick="openModal('usage')">â“ ì‚¬ìš© ë°©ë²•</button>
        </div>

        <div class="control-panel">
            <label class="control-label">
                ê·¼ì ˆ(Sarcomere) ê¸¸ì´: 
                <span id="lengthDisplay" class="length-value">4.50 Î¼m</span>
                <span id="deltaDisplay" class="delta-display">(ê¸°ì¤€ê°’)</span>
            </label>
            <input type="range" id="sarcomereSlider" min="0" max="18" value="9" step="1">
            <div class="range-labels">
                <span>3.6 Î¼m (ìµœëŒ€ ìˆ˜ì¶•)</span>
                <span style="color: #0066cc; font-weight: bold;">4.5 Î¼m (ê¸°ì¤€ê°’)</span>
                <span>5.4 Î¼m (ì´ì™„)</span>
            </div>
        </div>

        <div class="svg-container">
            <svg id="muscleSvg" width="800" height="300"></svg>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <h4>ğŸ“ í˜„ì¬ ê¸¸ì´ ì •ë³´</h4>
                <ul id="lengthList"></ul>
            </div>
            <div class="info-card">
                <h4>ğŸ“Š ê¸¸ì´ ë³€í™” (ê¸°ì¤€ê°’ ëŒ€ë¹„)</h4>
                <ul id="changesList"></ul>
            </div>
        </div>

        <div class="calculator">
            <h4>ğŸ§® ê¸¸ì´ ê³„ì‚°ê¸°</h4>
            <table>
                <thead>
                    <tr>
                        <th>ì„ íƒ 1</th>
                        <th>ì—°ì‚°ì</th>
                        <th>ì„ íƒ 2</th>
                        <th>ê²°ê³¼</th>
                    </tr>
                </thead>
                <tbody id="calculatorTable"></tbody>
            </table>
        </div>

        <footer>
            <div class="footer-content">
                <strong>ì¶©ë‚¨ì‚¼ì„±ê³ ë“±í•™êµ ê³¼í•™êµì‚¬ ì‹ ë„ê²½</strong><br>
                êµìœ¡ìš© ì‹œë®¬ë ˆì´í„° | 2025
            </div>
            <div class="developer-log">
                ë²„ì „ 1.1 | ìˆ˜ì •: ê¸°ì¤€ê°’ 4.5Î¼m ì„¤ì •, Mì„  ë™ì  ìœ„ì¹˜ ì¡°ì •
            </div>
        </footer>
    </div>

    <!-- ì´ë¡  ì„¤ëª… ëª¨ë‹¬ -->
    <div id="theoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“– ìŠ¬ë¼ì´ë”© í•„ë¼ë©˜íŠ¸ ì´ë¡ </h3>
                <span class="close" onclick="closeModal('theory')">&times;</span>
            </div>
            <div class="modal-body">
                <h4>ê¸°ë³¸ ì›ë¦¬</h4>
                <p>ê·¼ìœ¡ ìˆ˜ì¶• ì‹œ <strong>ì•¡í‹´(ê°€ëŠ” í•„ë¼ë©˜íŠ¸)</strong>ì´ <strong>ë§ˆì´ì˜¤ì‹ (êµµì€ í•„ë¼ë©˜íŠ¸)</strong> ì‚¬ì´ë¡œ ë¯¸ë„ëŸ¬ì ¸ ë“¤ì–´ê°€ë©´ì„œ ê·¼ì ˆ(sarcomere)ì˜ ê¸¸ì´ê°€ ì§§ì•„ì§‘ë‹ˆë‹¤.</p>
                
                <h4>ì£¼ìš” êµ¬ì¡°</h4>
                <ul>
                    <li><strong>Zì„ </strong>: ê·¼ì ˆì˜ ì–‘ ë ê²½ê³„</li>
                    <li><strong>Mì„ </strong>: ê·¼ì ˆì˜ ì •ì¤‘ì•™, ë§ˆì´ì˜¤ì‹ ì˜ ì¤‘ì‹¬</li>
                    <li><strong>AëŒ€</strong>: ë§ˆì´ì˜¤ì‹  í•„ë¼ë©˜íŠ¸ê°€ ìˆëŠ” ì˜ì—­ (1.8 Î¼m, ì¼ì •)</li>
                    <li><strong>IëŒ€</strong>: ì•¡í‹´ë§Œ ìˆëŠ” ì˜ì—­ (ìˆ˜ì¶• ì‹œ ê°ì†Œ)</li>
                    <li><strong>HëŒ€</strong>: ë§ˆì´ì˜¤ì‹ ë§Œ ìˆëŠ” ì˜ì—­ (ìˆ˜ì¶• ì‹œ ê°ì†Œ)</li>
                </ul>
                
                <h4>ìˆ˜ì¶• ì‹œ ë³€í™”</h4>
                <ul>
                    <li>ê·¼ì ˆ ê¸¸ì´ â†“ (Zì„  ê°„ ê±°ë¦¬ ê°ì†Œ)</li>
                    <li>IëŒ€ ê¸¸ì´ â†“</li>
                    <li>HëŒ€ ê¸¸ì´ â†“</li>
                    <li>AëŒ€ ê¸¸ì´ = ì¼ì •</li>
                    <li>ì•¡í‹´-ë§ˆì´ì˜¤ì‹  ê²¹ì¹˜ëŠ” êµ¬ê°„ â†‘</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ì‚¬ìš© ë°©ë²• ëª¨ë‹¬ -->
    <div id="usageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>â“ ì‚¬ìš© ë°©ë²•</h3>
                <span class="close" onclick="closeModal('usage')">&times;</span>
            </div>
            <div class="modal-body">
                <h4>1. ìŠ¬ë¼ì´ë” ì¡°ì‘</h4>
                <p>ìŠ¬ë¼ì´ë”ë¥¼ ì¢Œìš°ë¡œ ì›€ì§ì—¬ ê·¼ì ˆì˜ ê¸¸ì´ë¥¼ ë³€í™”ì‹œí‚µë‹ˆë‹¤.</p>
                <ul>
                    <li>ì™¼ìª½: ìµœëŒ€ ìˆ˜ì¶• ìƒíƒœ (3.6 Î¼m)</li>
                    <li>ì¤‘ì•™: ê¸°ì¤€ ìƒíƒœ (4.5 Î¼m)</li>
                    <li>ì˜¤ë¥¸ìª½: ì´ì™„ ìƒíƒœ (5.4 Î¼m)</li>
                </ul>
                
                <h4>2. ì‹œê°í™” ê´€ì°°</h4>
                <p>ê° êµ¬ì¡°ì˜ ë³€í™”ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.</p>
                <ul>
                    <li>íŒŒë€ìƒ‰ ì„ : ì•¡í‹´ í•„ë¼ë©˜íŠ¸</li>
                    <li>ë¹¨ê°„ìƒ‰ ì„ : ë§ˆì´ì˜¤ì‹  í•„ë¼ë©˜íŠ¸</li>
                    <li>íŒŒë€ìƒ‰ êµµì€ ì„ : Zì„ </li>
                    <li>ì£¼í™©ìƒ‰ ì ì„ : Mì„ </li>
                </ul>
                
                <h4>3. ê¸¸ì´ ì •ë³´ í™•ì¸</h4>
                <p>"í˜„ì¬ ê¸¸ì´ ì •ë³´"ì—ì„œ ê° êµ¬ì¡°ì˜ ê¸¸ì´ë¥¼ í™•ì¸í•˜ê³ , "ê¸¸ì´ ë³€í™”"ì—ì„œ ê¸°ì¤€ê°’(4.5 Î¼m) ëŒ€ë¹„ ë³€í™”ëŸ‰ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
                
                <h4>4. ê³„ì‚°ê¸° í™œìš©</h4>
                <p>ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ë‘ ê°’ì„ ì„ íƒí•˜ê³  ì—°ì‚°ìë¥¼ ì„ íƒí•˜ì—¬ ê´€ê³„ì‹ì„ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <script>
        // ìƒìˆ˜ ì •ì˜
        const umToPx = (um) => um / (5.0 / 700);
        const aBandUm = 1.8;
        const actinUm = 1.8;
        const actinLength = umToPx(actinUm);
        const myosinLengthPx = umToPx(aBandUm);
        const centerX = (750 + 50) / 2;
        const baselineSarcomere = 4.5; // ê¸°ì¤€ê°’

        // ê·¼ì ˆ ê¸¸ì´ í…Œì´ë¸” (ì™¼ìª½: ìˆ˜ì¶•, ì˜¤ë¥¸ìª½: ì´ì™„)
        const sarcomereLengthTable = Array.from({ length: 19 }, (_, i) => 3.6 + i * 0.1);

        // ì„ íƒ ê°€ëŠ¥í•œ ê¸¸ì´ ì˜µì…˜
        const lengthOptions = [
            "AëŒ€ ê¸¸ì´", "ë§ˆì´ì˜¤ì‹ ", "ì•¡í‹´", "HëŒ€ ê¸¸ì´", 
            "IëŒ€ ê¸¸ì´", "ê²¹ì¹˜ëŠ” êµ¬ê°„", "Â½ IëŒ€ ê¸¸ì´", "Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„"
        ];

        // ê¸°ì¤€ê°’ (4.5 Î¼m ê¸°ì¤€)
        const referenceValues = {
            "HëŒ€ ê¸¸ì´": 0.9,        // 4.5 - 1.8 - 1.8 = 0.9
            "IëŒ€ ê¸¸ì´": 2.7,        // 4.5 - 1.8 = 2.7
            "Â½ IëŒ€ ê¸¸ì´": 1.35,     // 2.7 / 2 = 1.35
            "ê²¹ì¹˜ëŠ” êµ¬ê°„": 0.9,     // 5.4 - 4.5 = 0.9
            "Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„": 0.45   // 0.9 / 2 = 0.45
        };

        // ê³„ì‚°ê¸° ìƒíƒœ
        let calculatorRows = Array(6).fill(null).map(() => ["", "+", ""]);

        // ëª¨ë‹¬ ì œì–´
        function openModal(type) {
            document.getElementById(type + 'Modal').style.display = 'block';
        }

        function closeModal(type) {
            document.getElementById(type + 'Modal').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // SVG ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function drawMuscle(sarcomereUm) {
            const svg = document.getElementById('muscleSvg');
            svg.innerHTML = '';

            const minSarcomereUm = 2 * actinUm;
            sarcomereUm = Math.max(sarcomereUm, minSarcomereUm);

            const pxToUm = 5.0 / 700;
            const pxLength = sarcomereUm / pxToUm;
            const leftZ = centerX - pxLength / 2;
            const rightZ = centerX + pxLength / 2;

            // ë§ˆì´ì˜¤ì‹ ì„ ê·¼ì ˆ ì¤‘ì‹¬ì— ë°°ì¹˜
            const myosinStart = centerX - myosinLengthPx / 2;
            const myosinEnd = centerX + myosinLengthPx / 2;

            const hStart = leftZ + actinLength;
            const hEnd = rightZ - actinLength;

            // Zì„ 
            svg.innerHTML += `
                <line x1="${leftZ}" y1="80" x2="${leftZ}" y2="220" stroke="#0066cc" stroke-width="4"/>
                <line x1="${rightZ}" y1="80" x2="${rightZ}" y2="220" stroke="#0066cc" stroke-width="4"/>
                <text x="${leftZ}" y="240" font-size="14" text-anchor="middle" fill="#0066cc" font-weight="bold">Zì„ </text>
                <text x="${rightZ}" y="240" font-size="14" text-anchor="middle" fill="#0066cc" font-weight="bold">Zì„ </text>
            `;

            // ì•¡í‹´ í•„ë¼ë©˜íŠ¸
            [100, 140, 180, 220].forEach(y => {
                svg.innerHTML += `
                    <rect x="${leftZ}" y="${y}" width="${actinLength}" height="6" fill="#4169E1" rx="3"/>
                    <rect x="${rightZ - actinLength}" y="${y}" width="${actinLength}" height="6" fill="#4169E1" rx="3"/>
                `;
            });

            // ë§ˆì´ì˜¤ì‹  í•„ë¼ë©˜íŠ¸ (ì¤‘ì‹¬ ê¸°ì¤€)
            [112, 153, 194].forEach(y => {
                svg.innerHTML += `<rect x="${myosinStart}" y="${y}" width="${myosinLengthPx}" height="18" fill="#DC143C" rx="4"/>`;
            });

            // Mì„  (ê·¼ì ˆ ì¤‘ì‹¬)
            const mLineX = centerX;
            svg.innerHTML += `
                <line x1="${mLineX}" y1="80" x2="${mLineX}" y2="220" stroke="#FFA500" stroke-width="3" stroke-dasharray="5 5"/>
                <text x="${mLineX}" y="70" font-size="14" text-anchor="middle" fill="#FFA500" font-weight="bold">Mì„ </text>
            `;

            // AëŒ€
            svg.innerHTML += `
                <rect x="${myosinStart}" y="40" width="${myosinLengthPx}" height="12" stroke="#333" fill="rgba(220,20,60,0.1)" stroke-dasharray="4 2"/>
                <text x="${mLineX}" y="30" font-size="14" text-anchor="middle" font-weight="bold">AëŒ€</text>
            `;

            // HëŒ€
            if (hEnd > hStart) {
                svg.innerHTML += `
                    <rect x="${hStart}" y="250" width="${hEnd - hStart}" height="12" stroke="#4169E1" fill="rgba(65,105,225,0.1)" stroke-dasharray="4 2"/>
                    <text x="${(hStart + hEnd) / 2}" y="280" font-size="14" text-anchor="middle" fill="#4169E1" font-weight="bold">HëŒ€</text>
                `;
            }

            // IëŒ€
            if (myosinStart > leftZ) {
                svg.innerHTML += `
                    <rect x="${leftZ}" y="270" width="${myosinStart - leftZ}" height="12" stroke="#DC143C" fill="rgba(220,20,60,0.1)" stroke-dasharray="4 2"/>
                    <text x="${(leftZ + myosinStart) / 2}" y="295" font-size="12" text-anchor="middle" fill="#DC143C">Â½ IëŒ€</text>
                `;
            }
            if (rightZ > myosinEnd) {
                svg.innerHTML += `
                    <rect x="${myosinEnd}" y="270" width="${rightZ - myosinEnd}" height="12" stroke="#DC143C" fill="rgba(220,20,60,0.1)" stroke-dasharray="4 2"/>
                    <text x="${(rightZ + myosinEnd) / 2}" y="295" font-size="12" text-anchor="middle" fill="#DC143C">Â½ IëŒ€</text>
                `;
            }
        }

        // ê¸¸ì´ ê³„ì‚°
        function calculateLengths(sarcomereUm) {
            const contractionUm = 5.4 - sarcomereUm;
            const hBandUm = Math.max(0, sarcomereUm - 2 * actinUm);
            const iBandUmCurrent = Math.max(0, sarcomereUm - aBandUm);
            const iHalfBandUm = iBandUmCurrent / 2;
            const overlapUm = contractionUm;

            return {
                "AëŒ€ ê¸¸ì´": aBandUm,
                "ë§ˆì´ì˜¤ì‹ ": aBandUm,
                "ì•¡í‹´": actinUm,
                "HëŒ€ ê¸¸ì´": hBandUm,
                "IëŒ€ ê¸¸ì´": iBandUmCurrent,
                "ê²¹ì¹˜ëŠ” êµ¬ê°„": overlapUm,
                "Â½ IëŒ€ ê¸¸ì´": iHalfBandUm,
                "Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„": overlapUm / 2
            };
        }

        // í˜„ì¬ ê¸¸ì´ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateLengthInfo(lengths) {
            const lengthList = document.getElementById('lengthList');
            const items = [
                { name: "ê·¼ì ˆ ê¸¸ì´", value: parseFloat(document.getElementById('lengthDisplay').textContent) },
                { name: "AëŒ€ ê¸¸ì´", value: lengths["AëŒ€ ê¸¸ì´"] },
                { name: "ì•¡í‹´ ê¸¸ì´", value: lengths["ì•¡í‹´"] },
                { name: "HëŒ€ ê¸¸ì´", value: lengths["HëŒ€ ê¸¸ì´"] },
                { name: "IëŒ€ ê¸¸ì´", value: lengths["IëŒ€ ê¸¸ì´"] },
                { name: "ê²¹ì¹˜ëŠ” êµ¬ê°„", value: lengths["ê²¹ì¹˜ëŠ” êµ¬ê°„"] }
            ];

            lengthList.innerHTML = items.map(item => 
                `<li>${item.name}: <strong>${item.value.toFixed(2)} Î¼m</strong></li>`
            ).join('');
        }

        // ë³€í™” ì •ë³´ ì—…ë°ì´íŠ¸
        function updateChanges(lengths) {
            const changesList = document.getElementById('changesList');
            const items = [
                { name: "HëŒ€ ê¸¸ì´", value: lengths["HëŒ€ ê¸¸ì´"], ref: referenceValues["HëŒ€ ê¸¸ì´"] },
                { name: "IëŒ€ ê¸¸ì´", value: lengths["IëŒ€ ê¸¸ì´"], ref: referenceValues["IëŒ€ ê¸¸ì´"] },
                { name: "ê²¹ì¹˜ëŠ” êµ¬ê°„", value: lengths["ê²¹ì¹˜ëŠ” êµ¬ê°„"], ref: referenceValues["ê²¹ì¹˜ëŠ” êµ¬ê°„"] },
                { name: "Â½ IëŒ€ ê¸¸ì´", value: lengths["Â½ IëŒ€ ê¸¸ì´"], ref: referenceValues["Â½ IëŒ€ ê¸¸ì´"] },
                { name: "Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„", value: lengths["Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„"], ref: referenceValues["Â½ ê²¹ì¹˜ëŠ” êµ¬ê°„"] }
            ];

            changesList.innerHTML = items.map(item => {
                const delta = item.value - item.ref;
                const deltaClass = delta < 0 ? 'delta-negative' : delta > 0 ? 'delta-positive' : 'delta-info';
                return `<li>${item.name}: <strong>${item.value.toFixed(2)} Î¼m</strong> <span class="${deltaClass}">(Î” ${delta.toFixed(2)} Î¼m)</span></li>`;
            }).join('');
        }

        // ê³„ì‚°ê¸° í…Œì´ë¸” ìƒì„±
        function createCalculatorTable() {
            const table = document.getElementById('calculatorTable');
            table.innerHTML = '';

            for (let i = 0; i < 6; i++) {
                const row = document.createElement('tr');
                
                // ì„ íƒ 1
                const select1 = document.createElement('select');
                select1.innerHTML = '<option value="">ì„ íƒ ì•ˆ í•¨</option>' + 
                    lengthOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('');
                select1.value = calculatorRows[i][0];
                select1.onchange = () => {
                    calculatorRows[i][0] = select1.value;
                    updateCalculator();
                };

                // ì—°ì‚°ì ì„ íƒ
                const selectOp = document.createElement('select');
                selectOp.className = 'operator-select';
                selectOp.innerHTML = `
                    <option value="+">+</option>
                    <option value="-">âˆ’</option>
                    <option value="*">Ã—</option>
                    <option value="/">Ã·</option>
                `;
                selectOp.value = calculatorRows[i][1];
                selectOp.onchange = () => {
                    calculatorRows[i][1] = selectOp.value;
                    updateCalculator();
                };

                // ì„ íƒ 2
                const select2 = document.createElement('select');
                select2.innerHTML = '<option value="">ì„ íƒ ì•ˆ í•¨</option>' + 
                    lengthOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('');
                select2.value = calculatorRows[i][2];
                select2.onchange = () => {
                    calculatorRows[i][2] = select2.value;
                    updateCalculator();
                };

                const td1 = document.createElement('td');
                td1.appendChild(select1);
                const td2 = document.createElement('td');
                td2.appendChild(selectOp);
                const td3 = document.createElement('td');
                td3.appendChild(select2);
                const td4 = document.createElement('td');
                td4.id = `calc-result-${i}`;

                row.appendChild(td1);
                row.appendChild(td2);
                row.appendChild(td3);
                row.appendChild(td4);
                table.appendChild(row);
            }
        }

        // ê³„ì‚°ê¸° ê²°ê³¼ ì—…ë°ì´íŠ¸
        function updateCalculator() {
            const slider = document.getElementById('sarcomereSlider');
            const sarcomereUm = sarcomereLengthTable[slider.value];
            const lengths = calculateLengths(sarcomereUm);

            calculatorRows.forEach((row, idx) => {
                const resultCell = document.getElementById(`calc-result-${idx}`);
                const [key1, operator, key2] = row;
                
                if (!key1 && !key2) {
                    resultCell.textContent = '-';
                } else if (!key1 || !key2) {
                    resultCell.textContent = 'ê°’ì„ ì„ íƒí•˜ì„¸ìš”';
                    resultCell.style.color = '#999';
                } else {
                    const v1 = lengths[key1] || 0;
                    const v2 = lengths[key2] || 0;
                    let result;
                    let operatorSymbol;
                    
                    switch(operator) {
                        case '+':
                            result = v1 + v2;
                            operatorSymbol = '+';
                            break;
                        case '-':
                            result = v1 - v2;
                            operatorSymbol = 'âˆ’';
                            break;
                        case '*':
                            result = v1 * v2;
                            operatorSymbol = 'Ã—';
                            break;
                        case '/':
                            result = v2 !== 0 ? v1 / v2 : 0;
                            operatorSymbol = 'Ã·';
                            if (v2 === 0) {
                                resultCell.textContent = '0ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                                resultCell.style.color = '#dc3545';
                                return;
                            }
                            break;
                        default:
                            result = v1 + v2;
                            operatorSymbol = '+';
                    }
                    
                    // ê¸°ì¤€ê°’ ê³„ì‚° (ë”í•˜ê¸°ì¼ ë•Œë§Œ Î” í‘œì‹œ)
                    if (operator === '+') {
                        const ref1 = referenceValues[key1] || 0;
                        const ref2 = referenceValues[key2] || 0;
                        const delta = result - (ref1 + ref2);
                        const deltaClass = delta < 0 ? 'delta-negative' : delta > 0 ? 'delta-positive' : '';
                        resultCell.innerHTML = `${result.toFixed(2)} Î¼m <span class="${deltaClass}">(Î” ${delta.toFixed(2)} Î¼m)</span>`;
                    } else {
                        // ë‹¤ë¥¸ ì—°ì‚°ì€ ê²°ê³¼ë§Œ í‘œì‹œ
                        resultCell.innerHTML = `<strong>${result.toFixed(2)}</strong> ${operator === '/' ? '' : 'Î¼m'}`;
                    }
                    resultCell.style.color = '#333';
                }
            });
        }

        // ë©”ì¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function update() {
            const slider = document.getElementById('sarcomereSlider');
            const sarcomereUm = sarcomereLengthTable[slider.value];
            const delta = sarcomereUm - baselineSarcomere;
            
            document.getElementById('lengthDisplay').textContent = `${sarcomereUm.toFixed(2)} Î¼m`;
            
            // ê¸°ì¤€ê°’ê³¼ì˜ ì°¨ì´ í‘œì‹œ
            const deltaDisplay = document.getElementById('deltaDisplay');
            if (Math.abs(delta) < 0.01) {
                deltaDisplay.textContent = '(ê¸°ì¤€ê°’)';
                deltaDisplay.style.color = '#666';
            } else {
                const sign = delta > 0 ? '+' : '';
                deltaDisplay.textContent = `(${sign}${delta.toFixed(2)} Î¼m)`;
                deltaDisplay.style.color = delta > 0 ? '#28a745' : '#dc3545';
            }
            
            drawMuscle(sarcomereUm);
            
            const lengths = calculateLengths(sarcomereUm);
            updateLengthInfo(lengths);
            updateChanges(lengths);
            updateCalculator();
        }

        // ì´ˆê¸°í™”
        document.getElementById('sarcomereSlider').addEventListener('input', update);
        createCalculatorTable();
        update();
    </script>
</body>
</html>
